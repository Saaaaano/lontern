doctype html 
html(lang="ja")
    head 
        meta(charset="utf-8")
        title lontern 
        link(rel="stylesheet" href="/css/stylesheet.css")
    body 
        div(class="session_main")
            div(class="header") #{room.name} 
            div(class="page")
                - var pageNum = Math.ceil(articleNum[1] / 20)
                - for(var p = 1; p <= pageNum; p++)
                    if p == articleNum[0] 
                        a #{p}｜
                        - continue
                    a(href="/session/" + room.name + "/" + p) #{p}
                    a ｜
            if character == null 
                - character = {}

            - var nomal = 0;
            if articleNum[0] >= 2
                - nomal = articleNum[0] * 20 - 20
            - for(let i = 0; i < comment.length; i++)
                case comment[i].section
                    when "secret"
                        if comment[i].send_to != character.character_name && comment[i].memberId != character.memberId 
                            - continue
                    when "action"
                        div(class="action") #{comment[i].comment} 
                        - continue 
                    when "solo"
                        if comment[i].character_name != character.character_name 
                            - continue 
                if comment[i].permission == "audience"
                    if character.permission != "audience"
                        - continue
                    
                div(class="preview")
                    a 
                        if comment[i].section == "anonymous"
                            img(src="/images/anonymous.png" width="110" height="110")
                        else 
                            img(src="/images/upload_icon/" + comment[i].image width="110" height="110")
                    div(class="speech_data" id="speechData")
                        - var audienceTag = ""
                        if comment[i].permission == "audience"
                            - audienceTag = "[観戦]"
                        case comment[i].section
                            when "solo"
                                a #{audienceTag} [独り言] #{comment[i].character_name} 
                                - break 
                            when "nomal"
                                if audienceTag
                                    a #{audienceTag} #{comment[i].charactername} 
                                else 
                                    - nomal++
                                    a #{nomal}. #{comment[i].character_name} 
                                - break
                            when "secret"
                                a #{audienceTag} [秘話] #{comment[i].character_name} → #{comment[i].send_to} 
                                - break
                            when "anonymous"
                                a #{audienceTag} [匿名]
                                - break 
                        a(class="date") #{comment[i].comment_at}
                        div
                            case comment[i].comment_vol
                                when "big"
                                    div(class="speech_" + comment[i].section)
                                        big 
                                            strong #{comment[i].comment} 
                                    - break 
                                when "small"
                                    div(class="speech_" + comment[i].section)
                                        small 
                                            font(color="gray") #{comment[i].comment} 
                                    - break 
                                when "nomal"
                                    div(class="speech_" + comment[i].section) #{comment[i].comment} 
                                    - break
                
            if character.character_name 
                div(class="say_space")
                    img(src="/images/upload_icon/" + character.image width="110" height="110")
                    div(class="say_box")
                        form(action="/say/" + character.sessionname + "/" + articleNum[0] method="post")
                            if character.permission == "audience"
                                a
                                    big 
                                        strong [観戦] 
                            a(class="name")
                                big 
                                    strong #{character.character_name} 
                            p(class="sayselect")
                                label
                                    a 発言種別: 
                                    select(name="say")
                                        option(value="nomal") セリフ
                                        option(value="secret") 秘匿
                                        option(value="anonymous") 匿名
                                        option(value="action") アクション
                                        option(value="solo") 独り言
                                label
                                    a(class="to_sel") To:
                                    select(name="to")
                                        option(value="GM") #{room.Owner}(GM)
                                        each member in members 
                                            if member.permission == character.permission
                                                option(value=member.character_name) #{member.character_name}
                            p
                                textarea(name="comment" rows="10" cols="80" required)
                            p 
                                label
                                    input(name="vol_size" value="nomal" type="radio" checked="checked") 
                                    a 通常
                                    input(name="vol_size" value="big" type="radio")
                                    a 大声
                                    input(name="vol_size" value="small" type="radio") 
                                    a 小声
                            p(class="say_btn")
                                input(class="say_submit" type="submit" value="発言")
                    
            div(class="topbtn")
                button(onclick="location.href='/index'") TOPに戻る
